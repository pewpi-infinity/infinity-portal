<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Infinity Launcher ¬∑ All-in-One Portal</title>
  <meta name="color-scheme" content="light dark"/>
  <style>
    :root {
      --blue-1: #003087;
      --blue-2: #0b5fd7;
      --bg: #fff;
      --panel: #f8fafc;
      --muted: #637083;
      --radius: 12px;
      font-family: system-ui, "Segoe UI", Roboto, Arial, sans-serif;
    }
    html, body { margin:0; padding:0; background:var(--bg); color:#051426; min-height:100vh;}
    .app { max-width:480px; margin:0 auto; padding:0 0 60px 0; }
    header { display:flex;align-items:center;justify-content:space-between;padding:14px 10px;background:#fff;border-bottom:1.5px solid #e6e9ef; }
    .logoText { font-weight:700; color:var(--blue-1); font-size:20px; letter-spacing:1px; }
    .sub { font-size:13px; color:var(--muted);}
    .nav { display:flex; gap:17px; }
    .nav a { color:var(--blue-2); font-weight:600; text-decoration:none; font-size:17px; padding:7px 0;}
    .nav a.active, .nav a:hover { border-bottom:2.5px solid var(--blue-2);}
    main { padding:20px 0 10px 0;}
    .card { background:var(--panel);border-radius:14px;padding:20px;margin-bottom:18px;box-shadow:0 2px 12px #00308716; }
    .card h2 { margin:0 0 8px 0; color:var(--blue-1);}
    .apps { display:flex; flex-direction:column; gap:18px; }
    .app-link { background:#fff; border-radius:10px; box-shadow:0 2px 12px #00308711; padding:16px; display:flex; flex-direction:column; align-items:flex-start;}
    .app-link a { color:var(--blue-2); font-weight:700; font-size:17px; text-decoration:none; }
    .desc { font-size:13px; color:var(--muted);margin-top:4px;}
    .live { color:#22c55e; font-weight:700; font-size:12px;}
    .panel { display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:1000; background:rgba(2,6,23,0.33);}
    .panel .content { background:#fff; border-radius:14px; max-width:410px; margin:60px auto; padding:20px; box-shadow:0 12px 40px #00308726;}
    .panel .close { position:absolute; right:18px; top:22px; background:none; border:0; font-size:22px; color:var(--muted); cursor:pointer;}
    .rogersDock { position:fixed; right:16px; bottom:16px; z-index:999; }
    .rogBtn { width:56px; height:56px; border-radius:50%; background:linear-gradient(135deg, var(--blue-1), var(--blue-2)); display:flex;align-items:center;justify-content:center; color:#fff;font-weight:900; font-size:28px; box-shadow:0 10px 30px #0b5fd71a; cursor:pointer; border:none;}
    .rogBtn img { width:100%; height:100%; object-fit:cover; border-radius:50%; display:block; }
    .chatBox { position:fixed; right:10px; bottom:80px; width:95vw; max-width:340px; border-radius:12px; background:#fff; box-shadow:0 20px 50px #03183e29; display:none; flex-direction:column; z-index:999; overflow:hidden; border:1px solid #e6e9ef;}
    .chatBox.open { display:flex; }
    .chatHeader { padding:10px 14px; background:linear-gradient(90deg, var(--blue-1), var(--blue-2)); color:#fff; display:flex; justify-content:space-between;align-items:center; font-weight:bold;}
    .chatBody { padding:12px;height:210px;overflow-y:auto;background:var(--panel);font-size:15px;}
    .chatInput { display:flex; padding:10px; border-top:1px solid #e6e9ef; background:#f9fbfd;}
    .chatInput input { flex:1;padding:8px;border-radius:8px;border:1px solid #e6e9ef;font-size:16px;}
    .chatInput button { background:var(--blue-1); color:#fff; border:none; border-radius:8px; font-weight:700; padding:8px 14px; margin-left:7px; font-size:16px;}
    .bubble { margin:7px 0; max-width:90%; padding:9px 13px; border-radius:13px; word-break:break-word;}
    .me { background:rgba(11,95,215,0.08); border:1px solid rgba(11,95,215,0.11);margin-left:auto;}
    .ai { background:#fff; border:1px solid #e6e9ef;}
    .sidebarBtn { position:fixed;left:12px;top: 64px;width:48px;height:48px;border-radius:12px;background:#fff;border:1px solid #e6e9ef;display:flex;align-items:center;justify-content:center;font-size:26px;color:var(--blue-2);z-index:1001;cursor:pointer;}
    .sidebar { position:fixed;left:0;top:0;bottom:0;width:86vw;max-width:320px;background:#fff;box-shadow:20px 0 60px #03183e19;transform:translateX(-110%);transition:transform .28s;z-index:9999;padding:22px 12px 0 12px;overflow:auto;}
    .sidebar.open { transform:translateX(0);}
    .sidebar h3 { margin-top:0;}
    .sbLink { display:block;padding:10px 0;font-weight:700;color:var(--blue-1);text-decoration:none;border-bottom:1px solid #eee;}
    .devBox { background:#f8fafc;border-radius:10px;padding:12px;margin-top:14px;}
    @media (max-width:600px) {
      .app { max-width:100vw; }
      .chatBox { left:4px; right:4px;width:auto;}
      .panel .content {width:97vw;max-width:97vw;}
      .sidebar { width:98vw;max-width:98vw;}
    }
  
/* === Live Widget (non-intrusive floating panel) === */
.liveFab { position: fixed; right: 16px; bottom: 16px; z-index: 9999; }
.liveFab button { 
  height: 52px; min-width: 52px; padding: 0 16px; 
  border-radius: 999px; border: none; cursor: pointer;
  background: linear-gradient(135deg, var(--blue-1), var(--blue-2));
  color: #fff; font-weight: 800; box-shadow: 0 10px 30px #0b5fd726;
}
.livePanel {
  position: fixed; right: 16px; bottom: 84px; width: min(92vw, 420px); 
  background: #0b1220; color: #e9eefc; border: 1px solid #0f274b; 
  border-radius: 16px; box-shadow: 0 20px 60px #00000066; 
  overflow: hidden; display: none; z-index: 9999;
}
.livePanel.open { display: block; }
.liveHeader { display:flex; align-items:center; justify-content:space-between; padding: 10px 12px; background: #071127; }
.liveHeader h4 { margin: 0; font-size: 14px; letter-spacing: .4px; }
.liveTabs { display:flex; gap:8px; }
.liveTabs button { background: transparent; color: #a9c2ff; border: 1px solid #0f274b; padding: 6px 10px; border-radius: 10px; cursor:pointer;}
.liveTabs button.active { background: #123; color: #fff; border-color: #1b4aa8; }
.liveBody { padding: 10px 12px 14px; }
.liveBody .row { margin-bottom: 10px; }
.liveSmall { font-size: 12px; opacity: .8; }
.liveInput { width: 100%; padding: 10px 12px; border-radius: 10px; border:1px solid #112a55; background:#0b1733; color:#e9eefc;}
.liveBtn { background:#1a4dd9; color:#fff; border:none; border-radius:10px; padding:10px 12px; cursor:pointer; font-weight:700;}
.liveBtn.secondary { background:#0e2a63; }
.liveMeta { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px; }
.liveMeta select, .liveMeta button { background:#0b1733; color:#e9eefc; border:1px solid #112a55; border-radius:10px; padding:6px 10px; }
.liveVideoShell { position: relative; background:#000; border-radius: 12px; overflow:hidden; }
.liveVideoShell video { width:100%; height:auto; display:block; }
.liveBadge { position:absolute; left:10px; top:10px; background:#e10; color:#fff; font-size:10px; padding:4px 8px; border-radius:8px; letter-spacing:.7px; }


/* Capture controls */
.captureRow { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:10px; }
.captureRow button, .captureRow select { background:#0b1733; color:#e9eefc; border:1px solid #112a55; border-radius:10px; padding:8px 10px; cursor:pointer; }
.captureRow button.primary { background:#1a4dd9; color:#fff; border:none; }
.captureRow .spacer { flex:1 1 auto; }


/* === Rogers bubble & chat panel === */
.rogersFab { position: fixed; right: 16px; bottom: 160px; z-index: 10000; }
.rogersBtn { width: 56px; height:56px; border-radius:50%; border:none; cursor:pointer;
  background:linear-gradient(135deg, var(--blue-1), var(--blue-2)); box-shadow:0 10px 30px #0b5fd726; display:flex; align-items:center; justify-content:center; }
.rogersBtn img { width:100%; height:100%; object-fit:cover; border-radius:50%; display:block; }
.rogersPanel { position: fixed; right: 16px; bottom: 228px; width: min(92vw, 420px);
  background:#0b1220; color:#e9eefc; border:1px solid #0f274b; border-radius: 16px; box-shadow:0 20px 60px #00000066;
  display:none; overflow:hidden; z-index: 10000; }
.rogersPanel.open { display:block; }
.rogersHead { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; background:#071127; }
.rogersHead .title { font-weight:800; font-size:14px; letter-spacing:.4px; }
.rogersHead .tokens { font-size:12px; opacity:.9; display:flex; align-items:center; gap:6px; }
.rogersHead .tokens .badge { background:#123; border:1px solid #1b4aa8; padding:4px 8px; border-radius:10px; }
.rogersMsgs { max-height: 50vh; overflow:auto; padding: 10px 12px; display:flex; flex-direction:column; gap:8px; }
.msg { padding:8px 10px; border-radius:12px; line-height:1.35; width: fit-content; max-width: 92%; }
.msg.user { background:#0b1733; border:1px solid #112a55; align-self:flex-end; }
.msg.bot { background:#10203e; border:1px solid #0f274b; align-self:flex-start; }
.rogersInputRow { display:flex; gap:8px; padding:10px 12px; border-top:1px solid #0f274b; }
.rogersInputRow input { flex:1; padding:10px 12px; border-radius:10px; border:1px solid #112a55; background:#0b1733; color:#e9eefc; }
.rogersInputRow button { padding:10px 12px; border-radius:10px; border:none; background:#1a4dd9; color:#fff; font-weight:800; cursor:pointer; }
.rogersFoot { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 12px; border-top:1px solid #0f274b; font-size:12px; opacity:.85; }
.rogersFoot button { background:#0e2a63; color:#e9eefc; border:1px solid #112a55; border-radius:10px; padding:6px 8px; cursor:pointer; }

</style>
</head>
<body>
  <div class="app">
    <header>
      <span class="logoText">INFINITY</span>
      <nav class="nav">
        <a href="#" class="active" onclick="showPanel('main')">Home</a>
        <a href="#" onclick="showPanel('dev')">Dev Tools</a>
      </nav>
    </header>
    <main id="mainPanel">
      <div class="card">
        <h2>Infinity All-in-One Launcher</h2>
        <div class="sub" style="margin-bottom:13px;">All your tools, AI, and projects‚Äîone page, mobile ready.</div>
        <div class="apps">
          <div class="app-link">
            <a href="http://127.0.0.1:8080" target="_blank">Portal UI</a>
            <div class="desc">Day-to-day dashboard, navigation, tools</div>
            <span class="live">LIVE on :8080</span>
          </div>
          <div class="app-link">
            <a href="http://127.0.0.1:5050" target="_blank">Rogers AI Chat</a>
            <div class="desc">Conversational AI, dev chat, steering wheel</div>
            <span class="live">LIVE on :5050</span>
          </div>
          <div class="app-link">
            <a href="http://127.0.0.1:8000" target="_blank">Socializer (Demo)</a>
            <div class="desc">Community chat, channels, games (edit URL as needed)</div>
            <span class="live">:8000 (if running)</span>
          </div>
          <div class="app-link">
            <a href="pi_singer.html" target="_blank">Pi Singer</a>
            <div class="desc">Digit-to-music generator (your code, local HTML file)</div>
          </div>
          <!-- Add more links as you discover new ports/sites -->
        </div>
      </div>
      <div class="card">
        <h2>Quick Actions & Resources</h2>
        <ul style="margin-left:18px;">
          <li>Sidebar: Access all settings, dev tools, saved sessions</li>
          <li>Floating Rogers AI: Chat anytime <b>R</b></li>
          <li>Visit each app, then bookmark for fast access</li>
        </ul>
      </div>
    </main>
    <!-- Dev Tools Panel -->
    <div class="panel" id="devPanel" onclick="closePanel(event)">
      <div class="content" onclick="event.stopPropagation()">
        <button class="close" onclick="hidePanel('dev')">‚úï</button>
        <h2>Developer & Steering Wheel</h2>
        <div class="devBox">
          <b>Session Storage:</b> <span id="sessCount"></span>
          <button onclick="clearSessions()" style="margin-left:8px;">Clear Sessions</button>
        </div>
        <div class="devBox">
          <b>API/Endpoint Config:</b><br>
          <input id="apiInput" style="width:97%;padding:9px;border-radius:7px;border:1.2px solid #e6e9ef;" placeholder="Paste Rogers/Infinity API URL here">
          <button onclick="saveApi()" style="margin-top:8px;">Save Endpoint</button>
          <div id="apiSaved" class="sub" style="margin-top:7px;"></div>
        </div>
        <div class="devBox">
          <b>Notes:</b>
          <ul style="font-size:13px;">
            <li>Your local Watson-style AI is wired in (no IBM key needed)</li>
            <li>Plug in endpoints for live AI, voice/video, or data</li>
            <li>All panel logic is in this file‚Äîedit & extend as you wish</li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Sidebar -->
    <button class="sidebarBtn" onclick="toggleSidebar()">‚ò∞</button>
    <aside class="sidebar" id="sidebar">
      <h3>Infinity Menu</h3>
      <a class="sbLink" href="#" onclick="showPanel('main');toggleSidebar()">Home</a>
      <a class="sbLink" href="#" onclick="showPanel('dev');toggleSidebar()">Dev Tools</a>
      <a class="sbLink" href="http://127.0.0.1:8080" target="_blank">Portal UI</a>
      <a class="sbLink" href="http://127.0.0.1:5050" target="_blank">Rogers AI Chat</a>
      <a class="sbLink" href="http://127.0.0.1:8000" target="_blank">Socializer</a>
      <a class="sbLink" href="pi_singer.html" target="_blank">Pi Singer</a>
      <div style="margin-top:18px;font-size:13px;color:#6b7280;">Contact: infinitystockinvesting@gmail.com</div>
    </aside>
    <!-- Rogers AI Dock -->
    <div class="rogersDock">
      <button class="rogBtn" id="rogBtn" title="Rogers AI"><img src="einstein-avatar.png" alt="Rogers Einstein" onerror="this.remove(); this.closest('button').textContent='R';"></button>
    </div>
    <div class="chatBox" id="chatBox">
      <div class="chatHeader">
        <span>Rogers AI</span>
        <button onclick="toggleChat()" style="background:transparent;border:none;color:#fff;font-size:20px;cursor:pointer;">‚úï</button>
      </div>
      <div class="chatBody" id="chatBody"></div>
      <form class="chatInput" onsubmit="event.preventDefault();sendChat();">
        <input id="chatIn" autocomplete="off" placeholder="Ask Rogers anything...">
        <button type="submit">Send</button>
      </form>
    </div>
  </div>
  <script>
    // --- Panel logic ---
    function showPanel(name){
      document.getElementById('mainPanel').style.display = (name==='main')?'block':'none';
      document.getElementById('devPanel').style.display = (name==='dev')?'flex':'none';
    }
    function hidePanel(name){ document.getElementById('devPanel').style.display='none'; }
    function closePanel(event){ if(event.target.classList.contains('panel')) hidePanel('dev'); }

    // --- Sidebar logic ---
    function toggleSidebar(){
      document.getElementById('sidebar').classList.toggle('open');
    }

    // --- Session/Dev logic ---
    function clearSessions(){
      localStorage.clear();
      document.getElementById('sessCount').innerText = '0';
    }
    function saveApi(){
      const val = document.getElementById('apiInput').value.trim();
      if(!val){ document.getElementById('apiSaved').innerText = 'Enter a URL first'; return; }
      localStorage.setItem('INFINITY_API', val);
      document.getElementById('apiSaved').innerText = 'Saved API endpoint!';
      setTimeout(()=>document.getElementById('apiSaved').innerText='',1800);
    }
    function updateSessCount(){
      let count = Object.keys(localStorage).length;
      document.getElementById('sessCount').innerText = count;
    }
    updateSessCount();

    // --- Rogers Chat Dock Logic ---
    const rogBtn = document.getElementById('rogBtn');
    const chatBox = document.getElementById('chatBox');
    rogBtn.onclick = () => { chatBox.classList.add('open'); setTimeout(()=>document.getElementById('chatIn').focus(), 120); }
    function toggleChat() { chatBox.classList.remove('open'); }

    // --- Simple Demo Brain (no backend required) ---
    const chatBody = document.getElementById('chatBody');
    const chatIn = document.getElementById('chatIn');
    function addBubble(role, text) {
      const div = document.createElement('div');
      div.className = 'bubble ' + (role === 'me' ? 'me' : 'ai');
      div.textContent = text;
      chatBody.appendChild(div);
      chatBody.scrollTop = chatBody.scrollHeight;
    }
    function sendChat() {
      const t = chatIn.value.trim();
      if (!t) return;
      addBubble('me', t);
      chatIn.value = '';
      setTimeout(() => {
        // Demo ‚ÄúWatson‚Äù reply (replace with real API if you want)
        let reply = '';
        if (/help|how/i.test(t)) reply = "I'm Rogers, your Infinity assistant. How can I help?";
        else if (/energy|token/i.test(t)) reply = "Energy features are in development. Check your profile soon!";
        else if (/voice|audio/i.test(t)) reply = "Voice features are coming! Try the mic in your next update.";
        else if (/weather|news/i.test(t)) reply = "Live data will be in the next Infinity release.";
        else reply = "Got it! (This is a demo. For live AI, connect the backend API.)";
        addBubble('ai', reply);
      }, 400);
    }
    // Welcome message
    addBubble('ai', "Hi! Rogers AI is ready. Ask anything or say 'help'.");
  </script>

<!-- === Live Video + Sign Up Widget (minimal footprint) === -->
<div class="liveFab" id="liveFab">
  <button id="toggleLive">‚óè Live</button>
</div>
<div class="livePanel" id="livePanel">
  <div class="liveHeader">
    <h4>Rogers Live ‚Äî Watson √ó Gemini (planned)</h4>
    <div class="liveTabs">
      <button id="tabLive" class="active">Live</button>
      <button id="tabSignup">Sign up</button>
    </div>
  </div>
  <div class="liveBody">
    <div id="panelLive">
      <div class="liveVideoShell">
        <span class="liveBadge">LIVE</span>
        <video id="liveVideo" playsinline webkit-playsinline x-webkit-airplay="allow" controls></video>
      </div>
      <div class="liveMeta">
        <select id="qualitySelect" title="Quality"></select>
        <button id="pipBtn" title="Picture-in-Picture">PiP</button>
        <button id="fsBtn" title="Fullscreen">Fullscreen</button>
        <button id="latencyBtn" title="Ultra Low Latency">ULL</button>
      </div>
      
<div class="captureRow">
  <select id="cameraSelect" title="Camera"></select>
  <select id="micSelect" title="Microphone"></select>
  <button id="startCam" class="primary">Camera</button>
  <button id="startScreen" class="primary">Screen</button>
  <button id="stopStream">Stop</button>
  <div class="spacer"></div>
  <button id="recBtn" title="Record to file">‚óè Rec</button>
</div>
<div class="row liveSmall">Broadcast note: This page can capture/preview/record locally. To stream to everyone, point the player to an HLS/DASH URL (Cloudflare Stream, Mux, YouTube Live, etc.).</div>

<div class="row liveSmall">Tip: Replace the stream URL in the widget config to go live instantly (HLS/DASH/MP4 supported).</div>
    </div>
    <div id="panelSignup" style="display:none">
      <div class="row"><input id="signupEmail" class="liveInput" type="email" placeholder="Email"></div>
      <div class="row"><input id="signupName" class="liveInput" type="text" placeholder="Display name (optional)"></div>
      <div class="row"><button id="signupBtn" class="liveBtn">Create account</button></div>
      <div class="row liveSmall">No passwords yet ‚Äî this is a local quick-start. We‚Äôll wire real auth later.</div>
      <div class="row liveSmall">Already set? You‚Äôre signed in as: <strong id="signedAs">‚Äî</strong></div>
    </div>
  </div>
</div>


<!-- CDN helpers for adaptive streaming -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.8"></script>
<script src="https://cdn.jsdelivr.net/npm/dashjs@4.7.4/dist/dash.all.min.js"></script>
<script>
(function(){
  // === Config (swap with your real stream) ===
  const LIVE_CONFIG = {
    // Public sample HLS (replace with your RTMP->HLS output or provider URL)
    hls: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",
    // Optional fallback MP4
    mp4: "https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
    // Optional DASH example (if you use MPEG-DASH)
    dash: ""
  };

  // UI binds
  const fab = document.getElementById('toggleLive');
  const livePanel = document.getElementById('livePanel');
  const tabLive = document.getElementById('tabLive');
  const tabSignup = document.getElementById('tabSignup');
  const panelLive = document.getElementById('panelLive');
  const panelSignup = document.getElementById('panelSignup');
  const video = document.getElementById('liveVideo');
  const qSel = document.getElementById('qualitySelect');
  const pipBtn = document.getElementById('pipBtn');
  const fsBtn = document.getElementById('fsBtn');
  const latencyBtn = document.getElementById('latencyBtn');
  const signedAs = document.getElementById('signedAs');
  const signupBtn = document.getElementById('signupBtn');
  const signupEmail = document.getElementById('signupEmail');
  const signupName = document.getElementById('signupName');

  // Persisted sign-in (local quick-start)
  const user = JSON.parse(localStorage.getItem('infinity_user') || 'null');
  if (user) { signedAs.textContent = user.name || user.email; }

  // Panel toggle
  document.getElementById('liveFab').addEventListener('click', () => {
    livePanel.classList.toggle('open');
  });

  // Tabs
  function activate(tab){
    if (tab === 'live') {
      tabLive.classList.add('active'); tabSignup.classList.remove('active');
      panelLive.style.display = ''; panelSignup.style.display = 'none';
    } else {
      tabSignup.classList.add('active'); tabLive.classList.remove('active');
      panelSignup.style.display = ''; panelLive.style.display = 'none';
    }
  }
  tabLive.addEventListener('click', () => activate('live'));
  tabSignup.addEventListener('click', () => activate('signup'));

  // Simple signup store
  signupBtn.addEventListener('click', () => {
    const email = (signupEmail.value || '').trim();
    const name = (signupName.value || '').trim();
    if (!email) return alert('Enter an email to continue.');
    const obj = { email, name, ts: Date.now() };
    localStorage.setItem('infinity_user', JSON.stringify(obj));
    signedAs.textContent = name || email;
    alert('Account created locally. We‚Äôll hook real auth next.');
  });

  // Streaming helpers
  let hls = null, dash = null;
  function unloadPlayers(){
    if (hls) { try { hls.destroy(); } catch(e){} hls = null; }
    if (dash) { try { dash.reset(); } catch(e){} dash = null; }
    video.removeAttribute('src'); video.load();
  }
  function setupHls(url){
    unloadPlayers();
    if (window.Hls && Hls.isSupported()) {
      hls = new Hls({ enableWorker: true, lowLatencyMode: true, liveSyncDurationCount: 2 });
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, function() {
        buildQualityMenu(hls.levels);
      });
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = url;
      buildQualityMenu([]); // native iOS player handles quality
    } else {
      // Fallback to MP4 if provided
      if (LIVE_CONFIG.mp4) setupMp4(LIVE_CONFIG.mp4);
    }
  }
  function setupDash(url){
    unloadPlayers();
    if (window.dashjs) {
      dash = dashjs.MediaPlayer().create();
      dash.updateSettings({ streaming: { lowLatencyEnabled: true } });
      dash.initialize(video, url, true);
      // Basic: leave quality auto for dash.js
      buildQualityMenu([]);
    }
  }
  function setupMp4(url){
    unloadPlayers();
    video.src = url;
    buildQualityMenu([]);
  }
  function buildQualityMenu(levels){
    qSel.innerHTML = '';
    if (!levels || !levels.length || !hls) {
      const opt = document.createElement('option');
      opt.value = 'auto'; opt.textContent = 'Auto';
      qSel.appendChild(opt);
      qSel.disabled = true;
      return;
    }
    qSel.disabled = false;
    const auto = document.createElement('option');
    auto.value = 'auto'; auto.textContent = 'Auto';
    qSel.appendChild(auto);
    levels.forEach((lvl, i) => {
      const opt = document.createElement('option');
      const res = (lvl.height ? (lvl.height + 'p') : (Math.round((lvl.bitrate||0)/1000) + 'kbps'));
      opt.value = i; opt.textContent = res;
      qSel.appendChild(opt);
    });
    qSel.addEventListener('change', () => {
      if (!hls) return;
      if (qSel.value === 'auto') { hls.currentLevel = -1; }
      else { hls.currentLevel = parseInt(qSel.value, 10); }
    });
  }

  // Buttons
  pipBtn.addEventListener('click', async () => {
    try {
      if (document.pictureInPictureElement) { await document.exitPictureInPicture(); }
      else if (video.requestPictureInPicture) { await video.requestPictureInPicture(); }
    } catch(e){ console.warn(e); }
  });
  fsBtn.addEventListener('click', async () => {
    try {
      if (!document.fullscreenElement) { await video.parentElement.requestFullscreen(); }
      else { await document.exitFullscreen(); }
    } catch(e){ console.warn(e); }
  });
  latencyBtn.addEventListener('click', () => {
    try { video.currentTime = video.buffered.end(0) - 0.25; } catch(e){}
  });

  // Auto-init stream by preference: HLS -> DASH -> MP4
  if (LIVE_CONFIG.hls) setupHls(LIVE_CONFIG.hls);
  else if (LIVE_CONFIG.dash) setupDash(LIVE_CONFIG.dash);
  else if (LIVE_CONFIG.mp4) setupMp4(LIVE_CONFIG.mp4);

  // Media Session niceties
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({
      title: 'Rogers Live', artist: 'Infinity OS', album: 'Watson √ó Gemini', artwork: []
    });
  }
})();
</script>


<!-- === Rogers bubble + panel === -->
<div class="rogersFab" id="rogersFab">
  <button class="rogersBtn" id="rogersBtn" title="Infinity Rogers AI">
    <img src="einstein-avatar.png" alt="Rogers" onerror="this.remove(); this.closest('button').textContent='R';">
  </button>
</div>
<div class="rogersPanel" id="rogersPanel">
  <div class="rogersHead">
    <div class="title">Infinity Rogers AI</div>
    <div class="tokens">Tokens <span class="badge" id="tokenBadge">‚àû 0</span></div>
  </div>
  <div class="rogersMsgs" id="rogersMsgs">
    <div class="msg bot">Hey Kris ‚Äî Rogers here. I‚Äôm live in-page. Ask me anything.</div>
  </div>
  <div class="rogersInputRow">
    <input id="rogersInput" type="text" placeholder="Type a message‚Ä¶" />
    <button id="rogersSend">Send</button>
  </div>
  <div class="rogersFoot">
    <div>1 token charged per reply.</div>
    <div>
      <button id="addTokens">+10 test tokens</button>
      <button id="rogersClose">Close</button>
    </div>
  </div>
</div>


<script>
(function(){
  const rogersBtn = document.getElementById('rogersBtn');
  const rogersPanel = document.getElementById('rogersPanel');
  const rogersMsgs = document.getElementById('rogersMsgs');
  const rogersInput = document.getElementById('rogersInput');
  const rogersSend = document.getElementById('rogersSend');
  const tokenBadge = document.getElementById('tokenBadge');
  const addTokensBtn = document.getElementById('addTokens');
  const rogersClose = document.getElementById('rogersClose');

  // Token store
  function getTokens(){ return parseInt(localStorage.getItem('infinity_tokens') || '20', 10); }
  function setTokens(n){ localStorage.setItem('infinity_tokens', String(n)); tokenBadge.textContent = '‚àû ' + n; }
  setTokens(getTokens());

  // Open/close
  rogersBtn.addEventListener('click', ()=> rogersPanel.classList.toggle('open'));
  rogersClose.addEventListener('click', ()=> rogersPanel.classList.remove('open'));

  // Add test tokens
  addTokensBtn.addEventListener('click', ()=> setTokens(getTokens()+10));

  function pushMsg(text, who='bot'){
    const div = document.createElement('div');
    div.className = 'msg ' + who;
    div.textContent = text;
    rogersMsgs.appendChild(div);
    rogersMsgs.scrollTop = rogersMsgs.scrollHeight;
  }

  async function rogersBrain(prompt){
    // SECURITY: API keys are stored in localStorage (client-side only)
    // NEVER hardcode API keys in this file or share them in bookmarklets
    // See SECURITY.md for best practices
    const apiKey = localStorage.getItem('openai_api_key') || '';
    if (apiKey && window.fetch) {
      try {
        const resp = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: [
              { role: 'system', content: 'You are Rogers, a helpful Infinity AI assistant for Kris. Be concise, honest, and practical.'},
              { role: 'user', content: prompt }
            ]
          })
        });
        const data = await resp.json();
        const out = data?.choices?.[0]?.message?.content?.trim();
        return out || 'No response received.';
      } catch(e){
        console.warn(e);
        return 'Network error. Using local fallback.';
      }
    }
    // Local fallback
    const canned = [
      "On it. What‚Äôs the very next thing you want live?",
      "Got it. I can wire that as a module without touching the rest.",
      "Acknowledged. I‚Äôll keep tokens at 1 per reply and track locally until Treasury is attached."
    ];
    return canned[Math.floor(Math.random()*canned.length)];
  }

  async function send(){
    const text = (rogersInput.value||'').trim();
    if (!text) return;
    pushMsg(text, 'user');
    rogersInput.value = '';
    // AI reply (charge 1 token)
    const left = getTokens();
    if (left <= 0) { pushMsg('Out of tokens. Tap ‚Äú+10 test tokens‚Äù to continue while Treasury is being wired.'); return; }
    setTokens(left - 1);
    pushMsg('Thinking‚Ä¶', 'bot');
    const reply = await rogersBrain(text);
    rogersMsgs.lastChild.textContent = reply;
  }

  rogersSend.addEventListener('click', send);
  rogersInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') send(); });

  // Optional: allow user to paste an OpenAI key once (saved locally)
  // SECURITY WARNING: Never hardcode API keys or share them in bookmarklets/URIs
  window.setOpenAIKey = function(k){ 
    if (!k || typeof k !== 'string') {
      alert('Invalid API key format');
      return;
    }
    
    // Warn about service account keys
    // Note: This checks for the current OpenAI service account key format (sk-svcacct-)
    // Update this pattern if OpenAI introduces new service account key formats
    if (k.toLowerCase().startsWith('sk-svcacct-')) {
      const confirmed = confirm(
        '‚ö†Ô∏è SECURITY WARNING ‚ö†Ô∏è\n\n' +
        'You are using a SERVICE ACCOUNT key which has elevated permissions.\n\n' +
        'NEVER share service account keys or include them in:\n' +
        '- Bookmarklets or javascript: URIs\n' +
        '- Public code or repositories\n' +
        '- Chat messages or emails\n\n' +
        'If this key has been exposed, REVOKE it immediately at:\n' +
        'https://platform.openai.com/api-keys\n\n' +
        'Continue anyway?'
      );
      if (!confirmed) return;
    }
    
    // Warn about any API key security
    // Note: OpenAI keys currently start with 'sk-'. This may need updating if formats change.
    // For additional security, warn about any string that looks like an API key
    if (k.startsWith('sk-') || /^[a-zA-Z]{2,10}-[a-zA-Z0-9_-]{20,}/.test(k)) {
      console.warn(
        'üîí SECURITY REMINDER:\n' +
        '- This key is stored locally in your browser only\n' +
        '- Never share your API key with others\n' +
        '- Never commit API keys to git repositories\n' +
        '- Rotate your keys regularly\n' +
        'See SECURITY.md for more information.'
      );
    }
    
    localStorage.setItem('openai_api_key', k); 
    alert('‚úì API key saved locally in your browser.\n\nRemember: Never share your API key!'); 
  };
})();
</script>

</body>
</html>